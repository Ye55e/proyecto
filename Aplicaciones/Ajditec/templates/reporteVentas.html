{% extends "plantilla_admin.html" %}
{% load static %}

{% block contenido %}
<br>
<h3 class="text-center">Reporte de Productos Vendidos</h3>

<form method="get" action="{% url 'reporte_ventas_productos' %}" class="row mb-4">
    <div class="col-md-3">
        <label for="fecha_inicio">Fecha inicio:</label>
        <input type="date" name="fecha_inicio" id="fecha_inicio" class="form-control" 
               value="{{ fecha_inicio }}" 
               {% if fecha_minima %}min="{{ fecha_minima }}"{% endif %}
               {% if fecha_maxima %}max="{{ fecha_maxima }}"{% endif %}>
    </div>
    <div class="col-md-3">
        <label for="fecha_fin">Fecha fin:</label>
        <input type="date" name="fecha_fin" id="fecha_fin" class="form-control" 
               value="{{ fecha_fin }}" 
               {% if fecha_minima %}min="{{ fecha_minima }}"{% endif %}
               {% if fecha_maxima %}max="{{ fecha_maxima }}"{% endif %}>
    </div>
    <div class="col-md-3">
        <label for="tipo">Tipo de reporte:</label>
        <select name="tipo" id="tipo" class="form-select">
            <option value="mayor" {% if tipo == "mayor" %}selected{% endif %}>Más vendidos</option>
            <option value="menor" {% if tipo == "menor" %}selected{% endif %}>Menos vendidos</option>
        </select>
    </div>
    <div class="col-md-3 d-flex align-items-end">
        <button type="submit" class="btn btn-primary w-100">Filtrar</button>
    </div>
</form>

<div class="card shadow">
    <div class="card-body">
        {% if productos_vendidos %}
            <table class="table table-bordered table-striped table-hover" id="tbl_productos">
                <thead class="table-dark">
                    <tr>
                        <th>Producto</th>
                        <th>Cantidad Vendida</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in productos_vendidos %}
                    <tr>
                        <td>{{ item.nomb_prod }}</td>
                        <td>{{ item.total_vendido }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% elif fecha_minima and fecha_maxima %}
            <div class="alert alert-info">
                Rango de fechas válido: del {{ fecha_minima }} al {{ fecha_maxima }}
            </div>
            <div class="alert alert-warning">
                No se encontraron productos que cumplan con el criterio de búsqueda.
            </div>
        {% else %}
            <div class="alert alert-info">
                Por favor, seleccione un rango de fechas válido y el tipo de reporte.
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  $(document).ready(function() {
    $('#tbl_productos').DataTable({
        scrollX:true,
        responsive:true,
      language: {
        url: '//cdn.datatables.net/plug-ins/1.13.5/i18n/es-ES.json'
      },
      dom: 'Bfrtip',
      buttons: [
        { extend: 'excelHtml5',  text: 'Excel',     className: 'btn btn-success me-2' },
        { extend: 'pdfHtml5',    text: 'PDF',       className: 'btn btn-danger me-2'  },
        { extend: 'print',       text: 'Imprimir',  className: 'btn btn-primary' }
      ]
    });
  });
</script>

<style>
    .table {
        width: 100% !important;
        table-layout: auto;
    }

    .card-body {
        padding: 0;
        overflow-x: auto;
    }

    #tbl_inventario_wrapper {
        overflow-x: auto;
    }

    div.dt-buttons .btn {
        margin-right: 10px;
    }
</style>
{% endblock %}
